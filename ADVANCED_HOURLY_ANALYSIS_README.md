# การวิเคราะห์ข้อมูลรายชั่วโมงแบบ Advanced

## ภาพรวม
โมดูลการวิเคราะห์ข้อมูลรายชั่วโมงแบบ Advanced เป็นส่วนขยายของระบบติดตามอ้อยเข้าโรงงาน ที่ให้การวิเคราะห์เชิงลึกเกี่ยวกับประสิทธิภาพการทำงานรายชั่วโมง

## ฟีเจอร์หลัก

### 1. การวิเคราะห์ประสิทธิภาพรายชั่วโมง
- **ดัชนีประสิทธิภาพรวม**: คะแนน 0-100 ที่ประเมินประสิทธิภาพโดยรวม
- **อัตราประสิทธิภาพ**: เปอร์เซ็นต์ของชั่วโมงที่มีการทำงาน
- **การกระจายประสิทธิภาพ**: แบ่งเป็น 4 ระดับ (สูง, ปานกลาง, ต่ำ, ไม่มีการทำงาน)
- **ผลิตภาพเฉลี่ย**: ตันต่อชั่วโมง, ตันต่อรถ

### 2. การวิเคราะห์แนวโน้ม
- **ทิศทางแนวโน้ม**: เพิ่มขึ้น, ลดลง, หรือคงที่
- **ความแรงของแนวโน้ม**: แข็งแกร่ง, ปานกลาง, หรืออ่อนแอ
- **การเปลี่ยนแปลงเปอร์เซ็นต์**: เปรียบเทียบครึ่งแรกกับครึ่งหลัง
- **ค่าสัมประสิทธิ์สหสัมพันธ์**: วัดความสัมพันธ์เชิงเส้น

### 3. การวิเคราะห์ความแปรปรวน
- **ระดับความเสถียร**: เสถียรมาก, เสถียร, ปานกลาง, ไม่เสถียร
- **ค่าสัมประสิทธิ์การแปรผัน**: วัดความแปรปรวนสัมพัทธ์
- **การตรวจสอบค่าผิดปกติ**: ระบุชั่วโมงที่มีค่าผิดปกติ
- **สถิติควอไทล์**: Q25, Q50, Q75, IQR

### 4. การวิเคราะห์ความสัมพันธ์
- **ความสัมพันธ์ระหว่าง Line A และ B**: วัดการทำงานร่วมกัน
- **ความสมดุลการผลิต**: ประเมินความสมดุลระหว่าง Line A และ B
- **อัตราส่วนการผลิต**: A:B ratio
- **ความสัมพันธ์ Fresh-Burnt**: วิเคราะห์สัดส่วนอ้อยสดและเผา

### 5. การวิเคราะห์ช่วงเวลาสูงสุด
- **ช่วงเวลาประสิทธิภาพสูง**: ระบุชั่วโมงที่มีประสิทธิภาพสูง
- **ช่วงเวลาต่อเนื่อง**: หาช่วงเวลาที่มีประสิทธิภาพสูงต่อเนื่อง
- **ช่วงเวลาที่ดีที่สุด**: ชั่วโมงที่มีประสิทธิภาพสูงสุด
- **อัตราส่วนประสิทธิภาพสูง**: เปอร์เซ็นต์ของชั่วโมงที่มีประสิทธิภาพสูง

### 6. การพยากรณ์
- **พยากรณ์ชั่วโมงถัดไป**: คาดการณ์ประสิทธิภาพชั่วโมงถัดไป
- **ช่วงความเชื่อมั่น**: 95% confidence interval
- **ระดับความเชื่อมั่น**: สูง, ปานกลาง, ต่ำ
- **การวิเคราะห์แนวโน้ม**: ใช้ moving average และ linear regression

## การใช้งาน

### 1. ผ่าน Web Interface
1. เข้าสู่ระบบหลัก
2. คลิกปุ่ม "การวิเคราะห์รายชั่วโมง" ในส่วน header
3. เลือกวันที่ที่ต้องการวิเคราะห์
4. คลิก "วิเคราะห์ข้อมูล"
5. ดูผลลัพธ์ในรูปแบบต่างๆ

### 2. ผ่าน API Endpoints

#### `/get_advanced_hourly_analysis`
```http
GET /get_advanced_hourly_analysis?date=2024-01-15
```

#### `/get_hourly_prediction`
```http
GET /get_hourly_prediction?date=2024-01-15&current_hour=15
```

#### `/get_hourly_performance_comparison`
```http
GET /get_hourly_performance_comparison?start_date=2024-01-10&end_date=2024-01-15
```

#### `/get_hourly_efficiency_report`
```http
GET /get_hourly_efficiency_report?date=2024-01-15
```

### 3. ผ่าน Python Code
```python
from advanced_hourly_analysis import analyze_hourly_data_advanced, predict_hourly_performance

# วิเคราะห์ข้อมูลรายชั่วโมง
result = analyze_hourly_data_advanced(hourly_data)

# พยากรณ์ประสิทธิภาพชั่วโมงถัดไป
prediction = predict_hourly_performance(hourly_data, current_hour)
```

## โครงสร้างข้อมูล

### ข้อมูลนำเข้า (Hourly Data)
```json
[
  {
    "Time": "00:00-01:00",
    "A_Count": 5,
    "A_Tons": 75.5,
    "B_Count": 3,
    "B_Tons": 45.2,
    "Total_Count": 8,
    "Total_Tons": 120.7,
    "Fresh_Tons": 85.0,
    "Burnt_Tons": 35.7,
    "hour": 0,
    "time_label": "00:00-01:00"
  }
]
```

### ผลลัพธ์การวิเคราะห์
```json
{
  "analysis": {
    "performance_metrics": {
      "total_tons": 2500.5,
      "total_trucks": 150,
      "active_hours": 18,
      "efficiency_ratio": 0.75,
      "avg_tons_per_hour": 104.2,
      "performance_distribution": {
        "high": 6,
        "medium": 8,
        "low": 4,
        "none": 6
      }
    },
    "trend_analysis": {
      "trend_direction": "increasing",
      "trend_strength": "moderate",
      "change_percentage": 15.5
    },
    "variability_analysis": {
      "stability_level": "stable",
      "coefficient_of_variation": 25.3,
      "outliers_count": 2
    },
    "overall_performance_index": {
      "overall_index": 78.5,
      "performance_level": "good"
    }
  },
  "insights": [
    "วันนี้มีการทำงาน 18 ชั่วโมง จาก 24 ชั่วโมง (ประสิทธิภาพ 75.0%)",
    "ผลิตภาพเฉลี่ย 104.2 ตันต่อชั่วโมง"
  ],
  "recommendations": [
    {
      "type": "efficiency",
      "priority": "medium",
      "title": "ปรับปรุงประสิทธิภาพการทำงาน",
      "description": "ประสิทธิภาพการทำงานอยู่ที่ 75.0% ซึ่งต่ำกว่าเกณฑ์ ควรตรวจสอบสาเหตุที่ทำให้มีชั่วโมงว่าง"
    }
  ]
}
```

## การติดตั้งและกำหนดค่า

### 1. ติดตั้ง Dependencies
```bash
pip install -r requirements.txt
```

### 2. กำหนดค่า Database
ตรวจสอบการตั้งค่าใน `config.ini`:
```ini
[DATABASE]
DRIVER={ODBC Driver 17 for SQL Server}
SERVER=192.168.100.1
DATABASE=dbPayment
UID=sa1
PWD=
TIMEOUT=10
```

### 3. รันระบบ
```bash
python app.py
```

### 4. เข้าถึง Advanced Analysis
เปิดเบราว์เซอร์ไปที่: `http://localhost:5000/advanced_hourly_analysis`

## การทดสอบ

### รันการทดสอบ
```bash
python test_advanced_hourly_analysis.py
```

### การทดสอบที่ครอบคลุม
- การวิเคราะห์ประสิทธิภาพ
- การวิเคราะห์แนวโน้ม
- การวิเคราะห์ความแปรปรวน
- การวิเคราะห์ความสัมพันธ์
- การพยากรณ์
- การสร้างข้อมูลเชิงลึกและคำแนะนำ

## การปรับแต่ง

### 1. เกณฑ์ประสิทธิภาพ
แก้ไขใน `advanced_hourly_analysis.py`:
```python
self.performance_thresholds = {
    'high': 100,      # ตันต่อชั่วโมง
    'medium': 50,     # ตันต่อชั่วโมง
    'low': 20         # ตันต่อชั่วโมง
}
```

### 2. น้ำหนักการคำนวณดัชนี
```python
weights = {
    'efficiency': 0.3,
    'consistency': 0.25,
    'productivity': 0.25,
    'balance': 0.2
}
```

## การแก้ไขปัญหา

### 1. ข้อผิดพลาดการเชื่อมต่อฐานข้อมูล
- ตรวจสอบการตั้งค่าใน `config.ini`
- ตรวจสอบการเชื่อมต่อเครือข่าย
- ตรวจสอบสิทธิ์การเข้าถึงฐานข้อมูล

### 2. ข้อผิดพลาดการวิเคราะห์
- ตรวจสอบข้อมูลนำเข้า
- ตรวจสอบ dependencies
- ดู log ใน console

### 3. ข้อผิดพลาด UI
- ตรวจสอบ JavaScript console
- ตรวจสอบการโหลด CSS/JS
- ตรวจสอบ API responses

## การพัฒนาต่อ

### 1. ฟีเจอร์ที่สามารถเพิ่มได้
- การวิเคราะห์ตามฤดูกาล
- การเปรียบเทียบกับข้อมูลอ้างอิง
- การแจ้งเตือนอัตโนมัติ
- การส่งออกรายงาน PDF
- การวิเคราะห์แบบ Real-time

### 2. การปรับปรุงประสิทธิภาพ
- การ cache ผลลัพธ์
- การประมวลผลแบบ parallel
- การใช้ฐานข้อมูล NoSQL
- การใช้ Machine Learning

## การสนับสนุน

หากพบปัญหาหรือต้องการความช่วยเหลือ:
1. ตรวจสอบ log files
2. รันการทดสอบ
3. ตรวจสอบ documentation
4. ติดต่อทีมพัฒนา

---

**หมายเหตุ**: โมดูลนี้ถูกออกแบบมาเพื่อให้การวิเคราะห์ข้อมูลรายชั่วโมงที่ครอบคลุมและแม่นยำ เพื่อช่วยในการตัดสินใจและปรับปรุงประสิทธิภาพการทำงานของโรงงานอ้อย
